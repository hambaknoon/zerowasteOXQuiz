<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œë¡œì›¨ì´ìŠ¤íŠ¸ OX í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script type="module">
    // Firebase SDK V9 Module Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyB-gGpaopmgAp0JAhhj7ghgB-0wbGeTWlE",
        authDomain: "moupcycle-3ae84.firebaseapp.com",
        projectId: "moupcycle-3ae84",
        storageBucket: "moupcycle-3ae84.firebasestorage.app",
        messagingSenderId: "808583858427",
        appId: "1:808583858427:web:36f2d7a75ec45bf4bf885e",
        measurementId: "G-ZDBL0Y0RX4"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const RESULTS_COLLECTION = 'quiz_results';

    // ----------------------------------------------------
    // ğŸ’¡ í†µí•©ëœ JavaScript ë¡œì§ ì‹œì‘
    // ----------------------------------------------------

    // --- 0. ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    const LOCAL_STORAGE_KEY = 'zero_waste_quiz_results';
    const LANG_STORAGE_KEY = 'zero_waste_quiz_lang'; // ì–¸ì–´ ì €ì¥ì„ ìœ„í•œ í‚¤ ì¶”ê°€
    
    // â­ 0-1. ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ë°ì´í„°
    const translations = {
        ko: {
            title: "í™˜ê²½ ì˜ì›… OX í€´ì¦ˆ",
            subtitle: "í€´ì¦ˆì— ì°¸ì—¬í•  ê·¸ë£¹ì„ ì„ íƒí•´ì£¼ì„¸ìš”!",
            ageGroups: {
                elementary: { text: "ì´ˆë“±í•™ìƒ (ê¼¬ë§ˆ ì˜ì›…)", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" },
                adolescent: { text: "ì²­ì†Œë…„ (ê·¸ë¦° ë¦¬ë”)", icon: "ğŸ§‘â€ğŸ’»" },
                adult: { text: "ì„±ì¸ (ì œë¡œì›¨ì´ìŠ¤íŠ¸ ì±”í”¼ì–¸)", icon: "ğŸ‘©â€ğŸ’¼" }
            },
            quizTitles: {
                elementary: "ê¼¬ë§ˆ ì˜ì›… í€´ì¦ˆ",
                adolescent: "ê·¸ë¦° ë¦¬ë” í€´ì¦ˆ",
                adult: "ì œë¡œì›¨ì´ìŠ¤íŠ¸ ì±”í”¼ì–¸ í€´ì¦ˆ"
            },
            quiz: {
                question: "ë¬¸ì œ",
                pressOX: "O / X ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”",
                nextQuestion: "ë‹¤ìŒ ë¬¸ì œ",
                backToStart: "ì²˜ìŒìœ¼ë¡œ"
            },
            answer: {
                correct: "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰",
                incorrect: "ì•„ì‰½ì§€ë§Œ ì˜¤ë‹µì…ë‹ˆë‹¤. ğŸ˜­",
                correctAnswer: "ì •ë‹µ:",
                pressNext: "'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”"
            },
            results: {
                complete: "í€´ì¦ˆ ì™„ë£Œ!",
                pledgeTitle: "ğŸ“ ë‚˜ì˜ ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë‹¤ì§",
                restart: "ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°",
                participantId: "ì°¸ê°€ ID:"
            },
            pledges: {
                elementary: "ë‚˜ëŠ” ì”ë°˜ ì—†ëŠ” ì ‘ì‹œë¥¼ ë§Œë“œëŠ” ê¼¬ë§ˆ ì§€êµ¬ ì§€í‚´ì´!",
                adolescent: "ë‚˜ëŠ” ì˜¤ëŠ˜ë¶€í„° ë¬¼ê±´ì„ ì¬ì‚¬ìš©í•˜ì—¬ ì“°ë ˆê¸°ë¥¼ ì¤„ì´ëŠ” ë©‹ì§„ í–‰ë™ê°€!",
                adult: "í•„ìš”í•˜ì§€ ì•Šì€ ê²ƒì€ NO! ì§€ê°‘ì„ ì—´ê¸° ì „ì— í•œ ë²ˆ ë” ìƒê°í•©ë‹ˆë‹¤."
            }
        },
        en: {
            title: "Eco Hero O/X Quiz",
            subtitle: "Please select your age group to start the quiz!",
            ageGroups: {
                elementary: { text: "Elementary (Little Hero)", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" },
                adolescent: { text: "Adolescent (Green Leader)", icon: "ğŸ§‘â€ğŸ’»" },
                adult: { text: "Adult (Zero Waste Champion)", icon: "ğŸ‘©â€ğŸ’¼" }
            },
            quizTitles: {
                elementary: "Little Hero Quiz",
                adolescent: "Green Leader Quiz",
                adult: "Zero Waste Champion Quiz"
            },
            quiz: {
                question: "Question",
                pressOX: "Press the O / X button",
                nextQuestion: "Next Question",
                backToStart: "Back to Start"
            },
            answer: {
                correct: "Correct! ğŸ‰",
                incorrect: "Incorrect. ğŸ˜­",
                correctAnswer: "Answer:",
                pressNext: "Please press the 'Next Question' button"
            },
            results: {
                complete: "Quiz Complete!",
                pledgeTitle: "ğŸ“ My Zero Waste Pledge",
                restart: "Back to Start",
                participantId: "Participant ID:"
            },
            pledges: {
                elementary: "I'm a little Earth Protector who makes a plate with no leftovers!",
                adolescent: "From today, I am a cool activist who reduces waste by reusing things!",
                adult: "NO to what's not needed! I think twice before opening my wallet."
            }
        }
    };

    const uuid = (typeof crypto !== 'undefined' && crypto.randomUUID)
        ? crypto.randomUUID.bind(crypto)
        : () => Math.random().toString(36).substring(2, 9);

    // â­ 0-2. ì–¸ì–´ ìƒíƒœ ë³€ìˆ˜ (ê¸°ë³¸ê°’: í•œêµ­ì–´, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ ì‹œ ë®ì–´ì“°ê¸°)
    let currentLang = localStorage.getItem(LANG_STORAGE_KEY) || 'ko';

    // í€´ì¦ˆ ë°ì´í„° ì „ì—­ ë³€ìˆ˜ (JSON ë¡œë”© ëŒ€ìƒ)
    let quizData = null;

    // í€´ì¦ˆ ê²°ê³¼ ë¡œì§ ê´€ë ¨ í•¨ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼)

    function saveResultLocally(result) {
        let results = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');
        results.push(result);
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(results));
    }

    async function saveResult(result) {
        try {
            const docRef = await addDoc(collection(db, RESULTS_COLLECTION), result);
            console.log("Firestoreì— ì €ì¥ ì™„ë£Œ. ë¬¸ì„œ ID: ", docRef.id);
        } catch (error) {
            console.error("Firestore ì €ì¥ ì˜¤ë¥˜:", error);
            alert("í€´ì¦ˆ ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì˜¤ë¥˜)");
            saveResultLocally(result); // ì„œë²„ ì €ì¥ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì— ì €ì¥
        }
    }

    // ----------------------------------------------------
    // 1. JSON ë¡œë”© í•¨ìˆ˜ (ë¹„ë™ê¸°)
    // ----------------------------------------------------

    async function loadQuizData() {
        try {
            // â­ í€´ì¦ˆ ë°ì´í„° íŒŒì¼ ì´ë¦„ì„ ì–¸ì–´ì™€ ê´€ë ¨ ì—†ì´ ë‹¨ì¼ íŒŒì¼ë¡œ ê°€ì • (oxquizData.json)
            const response = await fetch('./oxquizData.json'); 
            if (!response.ok) {
                throw new Error(`HTTP ì˜¤ë¥˜: ${response.status}`);
            }
            quizData = await response.json();
            console.log("í€´ì¦ˆ ë°ì´í„° ë¡œë“œ ì™„ë£Œ.");
            return true;
        } catch (error) {
            console.error("í€´ì¦ˆ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
            alert(`[ì˜¤ë¥˜] í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. oxquizData.json íŒŒì¼ì˜ ê²½ë¡œ ë° JSON í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.\nìƒì„¸: ${error.message}`);
            return false;
        }
    }

    // ----------------------------------------------------
    // 2. ìƒíƒœ ë³€ìˆ˜ ë° DOM ìš”ì†Œ ì„ ì–¸
    // ----------------------------------------------------
    
    let currentAgeGroup = '';
    let currentQuizSet = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let selectedSetIndex = 0;
    let localParticipantId_internal = 'guest-' + uuid();
    let answerLog = [];
    let correctLog = [];
    let screens = {}; // DOM ìš”ì†Œ ì»¨í…Œì´ë„ˆ

    // DOM ìš”ì†Œ ë³€ìˆ˜ (DOMContentLoaded ë‚´ì—ì„œ í• ë‹¹ë  ì˜ˆì •)
    let oBtn, xBtn, nextBtn, restartBtn, backToStartBtn, quizTitle; 
    let cardInner, questionNumberText, questionText, explanationText, answerBtnsContainer;
    let scoreText, resultEmoji, pledgeText, answerStatusText, correctAnswerText;
    let cardFront, cardEmojiFront, answerEmoji, localIdDisplay, cardBack;
    
    // â­ ì–¸ì–´ ê´€ë ¨ DOM ìš”ì†Œ ì¶”ê°€
    let mainTitle, mainSubtitle, ageSelectButtons, quizQuestionText, quizPressOXText, resultsCompleteText, resultsPledgeTitle, resultsParticipantId, resultsRestartBtn, quizBackToStartBtn, quizNextBtn;

    // ----------------------------------------------------
    // 3. ì–¸ì–´ ë° í€´ì¦ˆ í•µì‹¬ í•¨ìˆ˜
    // ----------------------------------------------------

    /**
     * í˜„ì¬ ì–¸ì–´ ìƒíƒœ(currentLang)ì— ë”°ë¼ ë©”ì¸ í˜ì´ì§€ì˜ ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
     */
    function updateUI() {
        const langData = translations[currentLang];
        const ageGroupsData = langData.ageGroups;

        // ë©”ì¸ í˜ì´ì§€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        mainTitle.textContent = langData.title;
        mainSubtitle.textContent = langData.subtitle;

        // ì—°ë ¹ ì„ íƒ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        ageSelectButtons.forEach(button => {
            const ageGroup = button.dataset.age;
            const data = ageGroupsData[ageGroup];
            button.innerHTML = `${data.icon} ${data.text}`; // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì—…ë°ì´íŠ¸
        });
        
        // í€´ì¦ˆ/ê²°ê³¼ í˜ì´ì§€ ë²„íŠ¼ ë° ê¸°íƒ€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (DOM ìš”ì†Œ í• ë‹¹ í›„ ì‹¤í–‰)
        if (quizBackToStartBtn) {
            quizBackToStartBtn.textContent = langData.quiz.backToStart;
            quizNextBtn.textContent = langData.quiz.nextQuestion;
            resultsCompleteText.textContent = langData.results.complete;
            resultsPledgeTitle.textContent = langData.results.pledgeTitle;
            resultsRestartBtn.textContent = langData.results.restart;
        }

        // HTML lang ì†ì„± ì—…ë°ì´íŠ¸
        document.documentElement.lang = currentLang;

        // êµ­ê¸° ì´ë¯¸ì§€ ì „í™˜
        const langKo = document.getElementById('lang-ko');
        const langEn = document.getElementById('lang-en');
        if (currentLang === 'ko') {
            langKo.classList.add('opacity-100');
            langKo.classList.remove('opacity-50', 'hover:opacity-75');
            langEn.classList.add('opacity-50', 'hover:opacity-75');
            langEn.classList.remove('opacity-100');
        } else {
            langEn.classList.add('opacity-100');
            langEn.classList.remove('opacity-50', 'hover:opacity-75');
            langKo.classList.add('opacity-50', 'hover:opacity-75');
            langKo.classList.remove('opacity-100');
        }
    }

    /**
     * ì–¸ì–´ ì „í™˜ í•¨ìˆ˜
     * @param {string} langCode 'ko' ë˜ëŠ” 'en'
     */
    function setLanguage(langCode) {
        if (langCode in translations && langCode !== currentLang) {
            currentLang = langCode;
            localStorage.setItem(LANG_STORAGE_KEY, langCode); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            updateUI();
        }
    }

    // í™”ë©´ ì „í™˜ í•¨ìˆ˜
    function showScreen(name) {
        Object.keys(screens).forEach(key => {
            screens[key].classList.add('hidden');
        });
        if (screens[name]) {
            screens[name].classList.remove('hidden');
        }
    }

    // í€´ì¦ˆ ì‹œì‘ í•¨ìˆ˜
    function startGame(event) {
        if (!quizData) {
            console.error("í€´ì¦ˆ ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            alert("ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
            return;
        }

        currentAgeGroup = event.currentTarget.dataset.age;
        
        const ageQuizSets = quizData[currentAgeGroup];
        if (!ageQuizSets || ageQuizSets.length === 0) {
            console.error("ì„ íƒëœ ì—°ë ¹ëŒ€ì˜ í€´ì¦ˆ ë°ì´í„° ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤:", currentAgeGroup);
            alert("ì„ íƒëœ ì—°ë ¹ëŒ€ì— í•´ë‹¹í•˜ëŠ” í€´ì¦ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        selectedSetIndex = Math.floor(Math.random() * ageQuizSets.length);
        currentQuizSet = ageQuizSets[selectedSetIndex];
        currentQuestionIndex = 0;
        score = 0;
        answerLog = [];
        correctLog = [];
        
        localParticipantId_internal = 'guest-' + uuid();
        
        // â­ ì–¸ì–´ì— ë”°ë¥¸ í€´ì¦ˆ ì œëª© ì„¤ì •
        quizTitle.textContent = translations[currentLang].quizTitles[currentAgeGroup] || 'Quiz';

        loadQuestion();
        showScreen('quiz');
    }

    // ë¬¸ì œ ë¡œë“œ í•¨ìˆ˜
    function loadQuestion() {
        const question = currentQuizSet[currentQuestionIndex];
        const langData = translations[currentLang];
        
        // ì¹´ë“œ ìƒíƒœ ì´ˆê¸°í™”
        cardInner.classList.remove('is-flipped');
        cardFront.classList.remove('card-correct', 'card-incorrect');
        answerBtnsContainer.classList.remove('hidden');
        cardBack.classList.remove('card-correct', 'card-incorrect');
        nextBtn.classList.add('hidden');
        
        // ë‚´ìš© ì—…ë°ì´íŠ¸
        // â­ ë¬¸ì œ ë²ˆí˜¸ í‘œì‹œ ì–¸ì–´ ì—…ë°ì´íŠ¸
        questionNumberText.textContent = `${langData.quiz.question} ${currentQuestionIndex + 1} / ${currentQuizSet.length}`;
        cardEmojiFront.textContent = question.emoji;
        // ------------------------------------------------------------------
        // â­ í•µì‹¬ ìˆ˜ì • ë¶€ë¶„: í€´ì¦ˆ ì§ˆë¬¸(Question) í…ìŠ¤íŠ¸ ë¡œì§
        // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” í‚¤(q_en ë˜ëŠ” q)ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
        questionText.textContent = question[currentLang === 'ko' ? 'q' : 'q_en'] || question.q;
        // ------------------------------------------------------------------
        
        // ------------------------------------------------------------------
        // â­ í•µì‹¬ ìˆ˜ì • ë¶€ë¶„: í•´ì„¤(Explanation) í…ìŠ¤íŠ¸ ë¡œì§
        // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” í‚¤(exp_en ë˜ëŠ” exp)ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
        explanationText.textContent = question[currentLang === 'ko' ? 'exp' : 'exp_en'] || question.exp;
        // ------------------------------------------------------------------
        
        // â­ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('quiz-prompt-text').textContent = langData.quiz.pressOX;
        document.getElementById('quiz-result-prompt-text').textContent = langData.answer.pressNext;

        oBtn.disabled = false;
        xBtn.disabled = false;
    }

    // ì •ë‹µ í™•ì¸ í•¨ìˆ˜
    function checkAnswer(userAnswer) {
        const question = currentQuizSet[currentQuestionIndex];
        const langData = translations[currentLang];
        const isCorrect = (userAnswer === question.a);
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸
        if (isCorrect) {
            score++;
            answerEmoji.textContent = "âœ…";
            answerStatusText.textContent = langData.answer.correct;
            cardBack.classList.add('card-correct');

        } else {
            answerStatusText.textContent = langData.answer.incorrect;
            answerEmoji.textContent = "âŒ";
            cardBack.classList.add('card-incorrect');
        }

        // ë¡œê·¸ ê¸°ë¡
        answerLog.push({ qIndex: currentQuestionIndex, q: question.q, u: userAnswer, a: question.a, lang: currentLang });
        correctLog.push(isCorrect);

        // ì¹´ë“œ ë’¤ì§‘ê¸°
        // â­ ì •ë‹µ í‘œì‹œ ì–¸ì–´ ì—…ë°ì´íŠ¸
        correctAnswerText.textContent = `${langData.answer.correctAnswer} ${question.a}`;
        cardInner.classList.add('is-flipped');

        // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        oBtn.disabled = true;
        xBtn.disabled = true;
        answerBtnsContainer.classList.add('hidden');
        nextBtn.classList.remove('hidden');		
    }

    // ë‹¤ìŒ ë¬¸ì œ/ê²°ê³¼ í™”ë©´ í•¨ìˆ˜
    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuizSet.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }
    
    // ê²°ê³¼ í™”ë©´ í‘œì‹œ ë° ì €ì¥ í•¨ìˆ˜
    function showResults() {
        showScreen('results');
        const langData = translations[currentLang];
        const totalQuestions = currentQuizSet.length;
        
        // ì ìˆ˜ ë° ë‹¤ì§ ë¬¸êµ¬ ì„¤ì •
        // â­ ì ìˆ˜ ë° ë‹¤ì§ ë¬¸êµ¬ ì–¸ì–´ ì—…ë°ì´íŠ¸
        scoreText.textContent = `${totalQuestions} ${langData.quiz.question} ${currentLang === 'ko' ? 'ì¤‘' : 'out of'} ${score} ${currentLang === 'ko' ? 'ê°œ ì •ë‹µ!' : 'correct!'}`;
        pledgeText.textContent = langData.pledges[currentAgeGroup];
        localIdDisplay.textContent = `${langData.results.participantId} ${localParticipantId_internal}`;
        
        // ì´ëª¨ì§€ ì„¤ì • (ì ìˆ˜ì— ë”°ë¥¸ ì´ëª¨ì§€ëŠ” ì–¸ì–´ì™€ ë¬´ê´€í•˜ê²Œ ìœ ì§€)
        if (score === totalQuestions) {
            resultEmoji.textContent = 'ğŸ‘‘';
        } else if (score >= totalQuestions * 0.7) {
            resultEmoji.textContent = 'ğŸŒŸ';
        } else {
            resultEmoji.textContent = 'ğŸ’¡';
        }
        
        const resultData = {
            id: localParticipantId_internal,
            ageGroup: currentAgeGroup,
            score: score,
            totalQuestions: totalQuestions,
            quizSetIndex: selectedSetIndex,
            timestamp: new Date().toISOString(),
            answerLog: answerLog,
            correctLog: correctLog,
            language: currentLang // â­ ì–¸ì–´ ì •ë³´ ì €ì¥ ì¶”ê°€
        };
        saveResultLocally(resultData); // ë¡œì»¬ ì €ì¥ì†Œ
        
        // Firestore ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
        saveResult(resultData);

        showScreen('results');
    }

    // ----------------------------------------------------
    // 4. DOMContentLoaded: ë¹„ë™ê¸° ë¡œë”© ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í†µí•©
    // ----------------------------------------------------

    document.addEventListener('DOMContentLoaded', async () => {
        // --- DOM ìš”ì†Œ ë³€ìˆ˜ í• ë‹¹ ---
        ageSelectButtons = document.querySelectorAll('.age-select-btn');
        oBtn = document.getElementById('o-btn');
        xBtn = document.getElementById('x-btn');
        nextBtn = document.getElementById('next-btn');
        restartBtn = document.getElementById('restart-btn');
        backToStartBtn = document.getElementById('back-to-start-btn');
        quizTitle = document.getElementById('quiz-title');

        screens = {
            ageSelection: document.getElementById('age-selection-screen'),
            quiz: document.getElementById('quiz-screen'),
            results: document.getElementById('results-screen')
        };

        cardInner = document.getElementById('card-inner');
        questionNumberText = document.getElementById('question-number-text');
        questionText = document.getElementById('question-text');
        explanationText = document.getElementById('explanation-text');
        answerBtnsContainer = document.getElementById('answer-btns');
        scoreText = document.getElementById('score-text');
        resultEmoji = document.getElementById('result-emoji');
        pledgeText = document.getElementById('pledge-text');
        answerStatusText = document.getElementById('answer-status-text');
        correctAnswerText = document.getElementById('correct-answer-text');
        
        // ì–¸ì–´ ê´€ë ¨ DOM ìš”ì†Œ í• ë‹¹
        mainTitle = document.getElementById('main-title');
        mainSubtitle = document.getElementById('main-subtitle');
        quizBackToStartBtn = document.getElementById('back-to-start-btn');
        quizNextBtn = document.getElementById('next-btn');
        resultsCompleteText = document.getElementById('results-complete-text');
        resultsPledgeTitle = document.getElementById('pledge-title');
        resultsParticipantId = document.getElementById('local-id-display');
        resultsRestartBtn = document.getElementById('restart-btn');
        
        // null ì²´í¬ë¥¼ í†µí•´ ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ì ‘ê·¼
        if (cardInner) {
            cardFront = cardInner.querySelector('.card-front');
            cardBack = document.getElementById('card-back');
        } else {
            console.error("DOM: 'card-inner' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        
        cardEmojiFront = document.getElementById('card-emoji-front');
        answerEmoji = document.getElementById('answer-emoji');
        localIdDisplay = document.getElementById('local-id-display');

        // â­ ì–¸ì–´ ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        document.getElementById('lang-ko').addEventListener('click', () => setLanguage('ko'));
        document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
        
        // --- í€´ì¦ˆ ë°ì´í„° ë¡œë”© (ë¹„ë™ê¸°) ---
        const dataLoaded = await loadQuizData();	
        if (!dataLoaded) {
            return;
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
        ageSelectButtons.forEach(button => {
            button.addEventListener('click', startGame);
        });

        oBtn.addEventListener('click', () => checkAnswer('O'));
        xBtn.addEventListener('click', () => checkAnswer('X'));
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', () => {
            showScreen('ageSelection');
        });
        backToStartBtn.addEventListener('click', () => {
            showScreen('ageSelection');
        });

        // â­ ì´ˆê¸° í™”ë©´ ì„¤ì • ì „ì— UI ì—…ë°ì´íŠ¸ë¥¼ í†µí•´ ì–¸ì–´ ì ìš©
        updateUI();
        showScreen('ageSelection');
    });

    // ----------------------------------------------------
    // ğŸ’¡ í†µí•©ëœ JavaScript ë¡œì§ ë
    // ----------------------------------------------------
</script>
    
    <style>
        body {
            font-family: 'Inter', 'Nanum Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* í”Œë˜ì‹œì¹´ë“œ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜ ì»¨í…Œì´ë„ˆ */
.perspective {
perspective: 1000px;
}
.card-inner {
position: relative;
width: 100%;
height: 100%;
transition: transform 0.6s;
transform-style: preserve-3d;
}
.is-flipped {
transform: rotateY(180deg);
}
.card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.75rem; 
            border: 4px solid transparent; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .card-back {
            transform: rotateY(180deg);
            background-image: linear-gradient(to top right, #e0f2fe, #f0f9ff);
        }
.answer-btn {
transition: background-color 0.15s, transform 0.15s, box-shadow 0.15s;
}
.answer-btn:active {
transform: scale(0.98);
box-shadow: none;
}
.card-correct {
border-color: #22c55e !important;
}
.card-incorrect {
border-color: #ef4444 !important;
}
    </style>
</head>
<body class="bg-emerald-50 text-gray-800">
    <div class="min-h-screen w-full flex flex-col items-center justify-center p-4 relative">
        
        <div class="absolute top-4 right-4 flex space-x-2 z-10">
            <img id="lang-ko" src="https://flagcdn.com/w20/kr.png" srcset="https://flagcdn.com/w40/kr.png 2x" alt="í•œêµ­ì–´" data-lang="ko" class="w-8 h-8 rounded-full shadow-lg cursor-pointer transition-opacity opacity-100">
            <img id="lang-en" src="https://flagcdn.com/w20/us.png" srcset="https://flagcdn.com/w40/us.png 2x" alt="English" data-lang="en" class="w-8 h-8 rounded-full shadow-lg cursor-pointer transition-opacity opacity-50 hover:opacity-75">
        </div>
        <div id="age-selection-screen" class="w-full max-w-lg md:max-w-xl text-center">
            <div class="bg-white p-6 md:p-10 rounded-2xl shadow-2xl">
                <div class="text-6xl md:text-7xl mb-4">ğŸŒ</div>
                <h1 id="main-title" class="text-2xl md:text-3xl font-bold text-emerald-700 mb-3">í™˜ê²½ ì˜ì›… OX í€´ì¦ˆ</h1>
                <p id="main-subtitle" class="text-gray-600 mb-8 text-lg">í€´ì¦ˆì— ì°¸ì—¬í•  ê·¸ë£¹ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
                <div class="grid grid-cols-1 gap-4">
                    <button data-age="elementary" class="age-select-btn bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-5 px-6 rounded-xl text-xl shadow-lg transition-transform transform hover:scale-105">
                        ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ì´ˆë“±í•™ìƒ (ê¼¬ë§ˆ ì˜ì›…)
                    </button>
                    <button data-age="adolescent" class="age-select-btn bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-5 px-6 rounded-xl text-xl shadow-lg transition-transform transform hover:scale-105">
                        ğŸ§‘â€ğŸ“ ì²­ì†Œë…„ (ê·¸ë¦° ë¦¬ë”)
                    </button>
                    <button data-age="adult" class="age-select-btn bg-gray-700 hover:bg-gray-800 text-white font-bold py-5 px-6 rounded-xl text-xl shadow-lg transition-transform transform hover:scale-105">
                        ğŸ‘©â€ğŸ’¼ ì„±ì¸ (ì œë¡œì›¨ì´ìŠ¤íŠ¸ ì±”í”¼ì–¸)
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-6" style="display: none;">âš ï¸ ì˜¤í”„ë¼ì¸ ëª¨ë“œ: í€´ì¦ˆ ê²°ê³¼ëŠ” ì´ ê¸°ê¸°ì— ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. ìµœì¢…ë²„ì „ì´ ë˜ì!! </p>
            </div>
        </div>

        <div id="quiz-screen" class="w-full max-w-lg md:max-w-xl hidden">
            <div class="flex justify-between items-center mb-4 px-2">
                <div>
                    <h2 id="quiz-title" class="text-xl md:text-2xl font-bold text-emerald-700">í€´ì¦ˆ ì œëª©</h2>
                    <p id="question-number-text" class="text-gray-500 font-semibold">ë¬¸ì œ 1 / 10</p>
                </div>
                <button id="back-to-start-btn" class="text-sm text-gray-500 hover:text-gray-700 font-semibold py-2 px-3 rounded-lg bg-white/70 hover:bg-white transition-all shadow-md">
                    ì²˜ìŒìœ¼ë¡œ
                </button>
            </div>

            <div class="perspective h-[450px] md:h-[500px]">
                <div id="card-inner" class="card-inner h-full">
                    <div class="card-front bg-white p-6 md:p-8">
                        <div id="card-emoji-front" class="text-7xl md:text-8xl text-center pt-8 pb-4">
                        </div>
                        <p id="question-text" class="text-xl md:text-2xl font-bold text-center flex-grow flex items-center justify-center leading-relaxed">
                            ë¬¸ì œ í…ìŠ¤íŠ¸
                        </p>
                        <p id="quiz-prompt-text" class="text-center text-gray-400 text-sm font-medium">O / X ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                    </div>

                    <div id="card-back" class="card-back p-6 md:p-8">
                        <div class="text-center">
                            <div id="answer-emoji" class="text-7xl md:text-8xl mb-4">
                            </div>
                            <h3 id="answer-status-text" class="text-3xl md:text-4xl font-extrabold mb-2">ì •ë‹µì…ë‹ˆë‹¤!</h3>
                            <h4 id="correct-answer-text" class="text-xl md:text-2xl font-bold text-gray-700 mb-4">ì •ë‹µ: O</h4>
                        </div>
                        <p id="explanation-text" class="text-base md:text-2xl font-bold text-gray-700 text-center leading-relaxed flex-grow flex items-center justify-center">
                            í•´ì„¤ í…ìŠ¤íŠ¸
                        </p>
                        <div class="text-center text-gray-500 text-sm font-medium pt-4">
                            <p id="quiz-result-prompt-text">'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="controls-container" class="mt-6">
                <div id="answer-btns" class="grid grid-cols-2 gap-4">
                    <button id="o-btn" class="answer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-6 rounded-xl text-4xl shadow-lg transition-transform transform hover:scale-105">O</button>
                    <button id="x-btn" class="answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-6 rounded-xl text-4xl shadow-lg transition-transform transform hover:scale-105">X</button>
                </div>
                <button id="next-btn" class="hidden w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-6 rounded-xl text-xl shadow-lg transition-transform transform hover:scale-105">
                    ë‹¤ìŒ ë¬¸ì œ
                </button>
            </div>
        </div>

        <div id="results-screen" class="w-full max-w-lg md:max-w-xl text-center hidden">
            <div class="bg-white p-6 md:p-10 rounded-2xl shadow-2xl">
                <div id="result-emoji" class="text-6xl md:text-7xl mb-4">ğŸ‰</div>
                <h1 id="results-complete-text" class="text-2xl md:text-3xl font-bold text-emerald-700 mb-2">í€´ì¦ˆ ì™„ë£Œ!</h1>
                <p id="score-text" class="text-gray-800 mb-6 text-2xl font-semibold">10 ë¬¸ì œ ì¤‘ 8 ê°œ ì •ë‹µ!</p>
                <div class="bg-emerald-50 p-4 rounded-lg mb-8 border border-emerald-200">
                    <h3 id="pledge-title" class="font-bold text-emerald-800 mb-2 text-lg">ğŸ“ ë‚˜ì˜ ì œë¡œì›¨ì´ìŠ¤íŠ¸ ë‹¤ì§</h3>
                    <p id="pledge-text" class="text-gray-700 font-medium text-base leading-relaxed">
                        ë‹¤ì§ ë¬¸êµ¬
                    </p>
                </div>
                <p id="local-id-display" class="text-xs text-gray-400 mt-4 mb-4 break-words">
                </p>

                <div class="space-y-4">
                    <button id="restart-btn" class="w-full bg-yellow-500 hover:bg-yellow-550 text-gray font-bold py-5 px-6 rounded-xl text-xl shadow-lg transition-transform transform hover:scale-105">
                        ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
